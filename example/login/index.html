<!DOCTYPE html>
<!--[if lt IE 7]><html lang="en" class="no-js lt-ie9 lt-ie8 lt-ie7"><![endif]-->
<!--[if IE 7]><html lang="en" class="no-js lt-ie9 lt-ie8"><![endif]-->
<!--[if IE 8]><html lang="en" class="no-js lt-ie9"><![endif]-->
<!--[if gt IE 8]><!-->
<html lang="en" class="no-js"><!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <title>Stormpath Widget - Login Example</title>
    <script src="/js/app.js"></script>
    <script>
      console.log('Loaded Stormpath v%s.', Stormpath.version);

      function initializeView(stormpath) {
        var stormpathContainer = document.getElementById('stormpath-container');

        // Authenticated
        var authenticatedContainer = document.getElementById('authenticated');
        var forgotPasswordButton = document.getElementById('forgot-password-button');
        var loginButton = document.getElementById('login-button');
        var registerButton = document.getElementById('register-button');

        authenticatedContainer.style.display = 'none';
        loginButton.addEventListener('click', () => stormpath.showLogin(stormpathContainer));
        registerButton.addEventListener('click', () => stormpath.showRegistration(stormpathContainer));
        forgotPasswordButton.addEventListener('click', () => stormpath.showForgotPassword(stormpathContainer));

        // Unauthenticated
        var unauthenticatedContainer = document.getElementById('unauthenticated');
        var logoutButton = document.getElementById('logout-button');

        unauthenticatedContainer.style.display = 'none';
        logoutButton.addEventListener('click', () => stormpath.logout());
      }

      function onDocumentReady() {
        var stormpath = new Stormpath({
          // Robert's app: 'https://lawful-heron.apps.stormpath.io'
          // Robin's app: 'https://oval-summer.apps.dev.stormpath.io'
          appUri: 'https://lawful-heron.apps.stormpath.io'
        });

        stormpath.on('authenticated', () => {
          console.log('We\'re authenticated!');

          document.getElementById('authenticated').style.display = 'block';
          document.getElementById('unauthenticated').style.display = 'none';

          stormpath.getAccount().then((account) => {
            document.getElementById('account-full-name').innerHTML = account.givenName;
          });

          stormpath.getAccessToken().then((accessToken) => {
            document.getElementById('access-token').innerHTML = accessToken;
          });
        });

        stormpath.on('unauthenticated', () => {
          console.log('We\'re not authenticated. Showing login/registration options.');

          document.getElementById('authenticated').style.display = 'none';
          document.getElementById('unauthenticated').style.display = 'block';
        });

        stormpath.once('registered', function (account) {
          console.log('User just created a new account!', account);
        });

        stormpath.once('loggedIn', function (account) {
          console.log('User just logged in!', account);
        });

        stormpath.once('loggedOut', function () {
          console.log('User just logged out!');
        });

        initializeView(stormpath);
      }

      window.onload = onDocumentReady;
    </script>
  </head>
  <body>
    <div id="authenticated">
      You are logged in as <span id="account-full-name"></span>!<br><br>
      This is your access token: <span id="access-token"></span><br><br>
      <button id="logout-button">Logout</button>
      <hr>
    </div>
    <div id="unauthenticated">
      <button id="login-button">Login</button> or <button id="register-button">Create a new account</button>
      or <button id="forgot-password-button">Forgot Password</button>
      <hr>
    </div>
    <div id="stormpath-container"></div>
  </body>
</html>
