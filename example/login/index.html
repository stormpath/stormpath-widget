<!DOCTYPE html>
<!--[if lt IE 7]><html lang="en" class="no-js lt-ie9 lt-ie8 lt-ie7"><![endif]-->
<!--[if IE 7]><html lang="en" class="no-js lt-ie9 lt-ie8"><![endif]-->
<!--[if IE 8]><html lang="en" class="no-js lt-ie9"><![endif]-->
<!--[if gt IE 8]><!-->
<html lang="en" class="no-js"><!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/>
    <title>Stormpath Widget - Login Example</title>
    <script src="/js/app.js"></script>
    <script>
      console.log('Loaded Stormpath v%s.', Stormpath.version);

      function initializeView(stormpath) {
        var stormpathContainer = document.getElementById('dom-container');

        // Authenticated
        var authenticatedContainer = document.getElementById('authenticated');
        var forgotPasswordButton = document.getElementById('forgot-password-button');
        var loginButton = document.getElementById('login-button');
        var registerButton = document.getElementById('register-button');

        authenticatedContainer.style.display = 'none';
        loginButton.addEventListener('click', function() { stormpath.showLogin(); });
        registerButton.addEventListener('click', function() { stormpath.showRegistration(stormpathContainer); });
        forgotPasswordButton.addEventListener('click', function() { stormpath.showForgotPassword(stormpathContainer); });

        // Unauthenticated
        var unauthenticatedContainer = document.getElementById('unauthenticated');
        var logoutButton = document.getElementById('logout-button');

        unauthenticatedContainer.style.display = 'none';
        logoutButton.addEventListener('click', function() { stormpath.logout(); });

        if ((/#verify/).test(window.location.href)) {
          stormpath.showEmailVerification();
        }
      }

      function onDocumentReady() {
        var stormpath = new Stormpath({
          // Robert's app: 'https://lawful-heron.apps.stormpath.io'
          // Robin's app: 'https://oval-summer.apps.dev.stormpath.io'
          // Nate's app: https://serene-commander.apps.stormpath.io'
          appUri: 'https://serene-commander.apps.stormpath.io'
        });

        if ((/#change-password/).test(window.location.href)) {
          stormpath.showChangePassword();
        }

        stormpath.on('authenticated', function() {
          console.log('We\'re authenticated!');

          document.getElementById('authenticated').style.display = 'block';
          document.getElementById('unauthenticated').style.display = 'none';

          stormpath.getAccount().then(function (account) {
            document.getElementById('account-full-name').innerHTML = account.givenName;
          });

          stormpath.getAccessToken().then(function (accessToken) {
            document.getElementById('access-token').innerHTML = accessToken;
          });
        });

        stormpath.on('unauthenticated', function() {
          console.log('We\'re not authenticated. Showing login/registration options.');

          document.getElementById('authenticated').style.display = 'none';
          document.getElementById('unauthenticated').style.display = 'block';
        });

        stormpath.on('forgotPasswordSent', function (data) {
          console.log('User just requested to reset his password!', data);
        });

        stormpath.on('changedPassword', function() {
          console.log('User just changed his password!');
        });

        stormpath.once('registered', function (account) {
          console.log('User just created a new account!', account);
        });

        stormpath.once('loggedIn', function (account) {
          console.log('User just logged in!', account);
        });

        stormpath.once('loggedOut', function () {
          console.log('User just logged out!');
        });

        stormpath.on('loginError', function (error) {
          console.log('An error occured during social login: ', error);
        });

        initializeView(stormpath);
      }

      window.onload = onDocumentReady;
    </script>
  </head>
  <body>
    <div id="authenticated">
      You are logged in as <span id="account-full-name"></span>!<br><br>
      This is your access token: <span id="access-token"></span><br><br>
      <button id="logout-button">Logout</button>
      <hr>
    </div>
    <div id="unauthenticated">
      <button id="login-button">Login</button> or <button id="register-button">Create a new account</button>
      or <button id="forgot-password-button">Forgot Password</button>
      <hr>
    </div>
    <div id="dom-container"></div>
    <div id="dummy-content">
      <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nam quibus rebus efficiuntur voluptates, eae non sunt in potestate sapientis. Ita multa dicunt, quae vix intellegam. Familiares nostros, credo, Sironem dicis et Philodemum, cum optimos viros, tum homines doctissimos. Terram, mihi crede, ea lanx et maria deprimet. Quo modo? Sed ille, ut dixi, vitiose. Quae diligentissime contra Aristonem dicuntur a Chryippo. </p>

      <p>Quod autem principium officii quaerunt, melius quam Pyrrho; Quid enim? Si quicquam extra virtutem habeatur in bonis. Non autem hoc: igitur ne illud quidem. Nam de isto magna dissensio est. An haec ab eo non dicuntur? Voluptatem cum summum bonum diceret, primum in eo ipso parum vidit, deinde hoc quoque alienum; </p>

      <p>Nam si amitti vita beata potest, beata esse non potest. Te enim iudicem aequum puto, modo quae dicat ille bene noris. Duo Reges: constructio interrete. Dat enim intervalla et relaxat. De illis, cum volemus. Tu enim ista lenius, hic Stoicorum more nos vexat. Non quaero, quid dicat, sed quid convenienter possit rationi et sententiae suae dicere. Quo modo autem optimum, si bonum praeterea nullum est? Multa sunt dicta ab antiquis de contemnendis ac despiciendis rebus humanis; </p>

      <p>Invidiosum nomen est, infame, suspectum. Quae cum magnifice primo dici viderentur, considerata minus probabantur. Quae cum dixisset, finem ille. Tum Piso: Quoniam igitur aliquid omnes, quid Lucius noster? Ne amores quidem sanctos a sapiente alienos esse arbitrantur. At iam decimum annum in spelunca iacet. An tu me de L. Quamquam id quidem, infinitum est in hac urbe; Illud dico, ea, quae dicat, praeclare inter se cohaerere. Quae cum essent dicta, finem fecimus et ambulandi et disputandi. </p>

      <p>Et harum quidem rerum facilis est et expedita distinctio. Nos vero, inquit ille; Nam aliquando posse recte fieri dicunt nulla expectata nec quaesita voluptate. Dicimus aliquem hilare vivere; Ita relinquet duas, de quibus etiam atque etiam consideret. Quorum altera prosunt, nocent altera. Equidem soleo etiam quod uno Graeci, si aliter non possum, idem pluribus verbis exponere. Huic mori optimum esse propter desperationem sapientiae, illi propter spem vivere. Nec tamen ullo modo summum pecudis bonum et hominis idem mihi videri potest. Quid, si etiam iucunda memoria est praeteritorum malorum? </p>
    </div>
  </body>
</html>
